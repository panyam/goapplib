<!-- goapplib/templates/BasePage.html -->
<!-- Base page template - extend this for your pages -->
{{# include "Header.html" #}}
{{# include "components/Modal.html" #}}
{{# include "components/Toast.html" #}}
{{# include "components/SplashScreen.html" #}}

{{ define "BasePage" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }}</title>

    <!-- Theme initialization (before CSS to prevent flash) -->
    <script>
    if (localStorage.getItem('theme') === 'dark' ||
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
    </script>

    <!-- Tailwind CSS -->
    <link href="/static/css/tailwind.css" rel="stylesheet">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>

    {{ block "ExtraHeadSection" . }}{{ end }}
</head>

<body class="{{ or .BodyClass "h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200" }}" {{ .BodyDataAttributes | safeHTMLAttr }}>

    <!-- Splash Screen -->
    {{ if not .DisableSplashScreen }}
    {{ block "SplashScreenSection" . }}
        {{ template "DefaultSplashScreen" . }}
    {{ end }}
    {{ end }}

    <!-- Header -->
    {{ block "HeaderSection" . }}
        {{ if not .CustomHeader }}
        <div class="print:hidden sticky left-0 top-0 z-20 border-b border-gray-200 dark:border-gray-700">
            {{ template "Header" .Header }}
        </div>
        {{ end }}
    {{ end }}

    <!-- Main Body Content -->
    {{ block "BodySection" . }}
    <main class="flex-1 overflow-auto">
        <!-- Override this block in your page templates -->
    </main>
    {{ end }}

    <!-- Modal Container -->
    {{ block "ModalSection" . }}
    <div id="modal-container" class="hidden fixed inset-0 z-50">
        {{ template "ModalContainer" . }}
    </div>
    {{ end }}

    <!-- Toast Container -->
    {{ block "ToastSection" . }}
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2">
        {{ template "ToastContainer" . }}
    </div>
    {{ end }}

    <!-- Footer -->
    {{ block "FooterSection" . }}{{ end }}

    <!-- Pre-body scripts -->
    {{ block "PreScriptsSection" . }}{{ end }}

    <!-- Theme toggle script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('theme-toggle-button');
        if (toggleBtn) {
            toggleBtn.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme',
                    document.documentElement.classList.contains('dark') ? 'dark' : 'light'
                );
            });
        }

        // Hide splash screen
        const splash = document.getElementById('splash-screen');
        if (splash) {
            splash.style.opacity = '0';
            setTimeout(() => splash.remove(), 300);
        }
    });
    </script>

    <!-- Post-body scripts -->
    {{ block "PostScriptsSection" . }}{{ end }}
</body>
</html>
{{ end }}
